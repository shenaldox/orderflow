<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FLOWSTATE | Institutional Orderflow Education</title>
    <style>
        /* --- CSS VARIABLES & RESET --- */
        :root {
            --bg-dark: #0b0e11;
            --bg-panel: #131722;
            --bg-panel-hover: #1e222d;
            --border-color: #2a2e39;
            --text-primary: #d1d4dc;
            --text-secondary: #787b86;
            --accent-green: #00c853; /* Neon Green */
            --accent-red: #ff1744;   /* Neon Red */
            --accent-cyan: #2962ff;  /* Institutional Blue */
            --accent-yellow: #ffab00;
            --font-main: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Helvetica Neue", sans-serif;
            --font-mono: "Roboto Mono", "Courier New", monospace;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            background-color: var(--bg-dark);
            color: var(--text-primary);
            font-family: var(--font-main);
            line-height: 1.6;
            overflow-x: hidden;
        }

        a { text-decoration: none; color: inherit; transition: 0.3s; }
        ul { list-style: none; }

        /* --- UTILITY CLASSES (Tailwind-ish) --- */
        .container { max-width: 1280px; margin: 0 auto; padding: 0 20px; }
        .flex { display: flex; }
        .flex-col { flex-direction: column; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .justify-center { justify-content: center; }
        .grid { display: grid; }
        .grid-cols-2 { grid-template-columns: repeat(2, 1fr); }
        .grid-cols-3 { grid-template-columns: repeat(3, 1fr); }
        .gap-4 { gap: 1rem; }
        .gap-8 { gap: 2rem; }
        .text-center { text-align: center; }
        .text-green { color: var(--accent-green); }
        .text-red { color: var(--accent-red); }
        .font-mono { font-family: var(--font-mono); }
        .font-bold { font-weight: 700; }
        .mt-4 { margin-top: 1rem; }
        .mb-4 { margin-bottom: 1rem; }
        .p-4 { padding: 1rem; }
        .p-8 { padding: 2rem; }
        .w-full { width: 100%; }
        .h-full { height: 100%; }

        /* --- COMPONENT STYLES --- */

        /* Navigation */
        nav {
            background: rgba(19, 23, 34, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border-color);
            position: sticky;
            top: 0;
            z-index: 100;
            padding: 1rem 0;
        }
        .nav-logo { font-size: 1.5rem; font-weight: 800; letter-spacing: -1px; color: var(--text-primary); }
        .nav-logo span { color: var(--accent-cyan); }
        .nav-links a { margin-left: 2rem; font-size: 0.9rem; color: var(--text-secondary); font-weight: 500; }
        .nav-links a:hover, .nav-links a.active { color: var(--accent-cyan); }
        
        /* Buttons */
        .btn {
            padding: 10px 24px;
            border-radius: 4px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
            font-size: 0.9rem;
        }
        .btn-primary {
            background: var(--accent-cyan);
            color: white;
            box-shadow: 0 0 10px rgba(41, 98, 255, 0.3);
        }
        .btn-primary:hover { background: #1e54e8; box-shadow: 0 0 20px rgba(41, 98, 255, 0.6); }
        .btn-outline {
            background: transparent;
            border: 1px solid var(--border-color);
            color: var(--text-primary);
        }
        .btn-outline:hover { border-color: var(--text-primary); background: var(--bg-panel-hover); }

        /* Hero */
        .hero {
            padding: 80px 0;
            text-align: center;
            background: radial-gradient(circle at center, #1a202c 0%, var(--bg-dark) 70%);
        }
        .hero h1 { font-size: 3.5rem; margin-bottom: 1rem; line-height: 1.1; }
        .hero p { font-size: 1.2rem; color: var(--text-secondary); max-width: 600px; margin: 0 auto 2rem; }

        /* Cards & Panels */
        .panel {
            background: var(--bg-panel);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            overflow: hidden;
            position: relative;
        }
        .panel-header {
            padding: 12px 16px;
            border-bottom: 1px solid var(--border-color);
            font-size: 0.9rem;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            background: rgba(255,255,255,0.02);
        }

        /* Glassmorphism overlay */
        .glass-panel {
            background: rgba(19, 23, 34, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }

        /* Section Styles */
        section { padding: 60px 0; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .section-title { font-size: 2rem; margin-bottom: 1rem; }
        .section-subtitle { color: var(--accent-cyan); text-transform: uppercase; letter-spacing: 1px; font-size: 0.8rem; font-weight: 700; margin-bottom: 10px; display: block; }

        /* --- TRADING CHART & ORDERFLOW --- */
        .chart-container {
            height: 400px;
            width: 100%;
            background: #000;
            position: relative;
        }
        canvas#orderflowChart {
            width: 100%;
            height: 100%;
            display: block;
        }
        .chart-overlay {
            position: absolute;
            top: 10px;
            left: 10px;
            font-family: var(--font-mono);
            font-size: 0.8rem;
            pointer-events: none;
            color: var(--text-secondary);
        }

        /* --- DOM LADDER --- */
        .dom-ladder {
            font-family: var(--font-mono);
            font-size: 0.85rem;
            display: grid;
            grid-template-columns: 1fr 60px 1fr;
            width: 100%;
            height: 400px;
            overflow-y: hidden;
            position: relative;
        }
        .dom-cell { padding: 2px 8px; display: flex; align-items: center; justify-content: center; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .dom-price { color: var(--text-primary); font-weight: bold; }
        .dom-ask { color: var(--accent-red); background: rgba(255, 23, 68, 0.1); }
        .dom-bid { color: var(--accent-green); background: rgba(0, 200, 83, 0.1); }
        .dom-highlight { animation: flash 0.5s ease-out; background: rgba(255,255,255,0.2) !important; }
        
        @keyframes flash {
            0% { background: rgba(255,255,255,0.5); }
            100% { background: transparent; }
        }

        /* --- AI ANALYSIS SECTION --- */
        .ai-grid {
            display: grid;
            grid-template-columns: 3fr 1fr;
            gap: 1rem;
            height: 500px;
        }
        .ai-chart-area { position: relative; background: #000; border-radius: 8px; overflow: hidden; }
        .ai-sidebar { display: flex; flex-direction: column; gap: 1rem; }
        
        .ai-card {
            padding: 1rem;
            border-radius: 8px;
            background: var(--bg-panel);
            border-left: 4px solid transparent;
        }
        .ai-card.buy { border-color: var(--accent-green); }
        .ai-card.sell { border-color: var(--accent-red); }
        .ai-card.wait { border-color: var(--accent-yellow); }
        
        .stat-row { display: flex; justify-content: space-between; margin-top: 5px; font-size: 0.9rem; }
        .loader-bar { height: 4px; background: #333; border-radius: 2px; overflow: hidden; margin-top: 10px; display: none; }
        .loader-progress { height: 100%; background: var(--accent-cyan); width: 0%; transition: width 0.3s; }
        
        .overlay-box {
            position: absolute;
            border: 2px solid;
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-family: var(--font-mono);
            text-shadow: 0 2px 4px rgba(0,0,0,0.8);
            color: white;
        }

        /* --- DASHBOARD/JOURNAL --- */
        .journal-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }
        .journal-table th { text-align: left; padding: 12px; color: var(--text-secondary); border-bottom: 1px solid var(--border-color); }
        .journal-table td { padding: 12px; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .tag { padding: 2px 8px; border-radius: 4px; font-size: 0.75rem; font-weight: 600; }
        .tag-win { background: rgba(0,200,83,0.2); color: var(--accent-green); }
        .tag-loss { background: rgba(255,23,68,0.2); color: var(--accent-red); }

        /* Footer */
        footer { padding: 40px 0; border-top: 1px solid var(--border-color); text-align: center; color: var(--text-secondary); font-size: 0.9rem; }

        /* Responsive */
        @media (max-width: 768px) {
            .grid-cols-2, .grid-cols-3, .ai-grid { grid-template-columns: 1fr; }
            .hero h1 { font-size: 2.5rem; }
            .nav-links { display: none; } /* Simplified for mobile */
            .dom-ladder { height: 300px; }
        }
    </style>
</head>
<body>

    <!-- NAV -->
    <nav>
        <div class="container flex justify-between items-center">
            <div class="nav-logo">FLOW<span>STATE</span></div>
            <div class="nav-links">
                <a href="#home">Home</a>
                <a href="#methods">Trading Methods</a>
                <a href="#dom-education">DOM Trading</a>
                <a href="#ai-analysis">AI Analysis</a>
                <a href="#dashboard">Journal</a>
            </div>
            <button class="btn btn-primary" onclick="scrollToId('ai-analysis')">Try AI Scanner</button>
        </div>
    </nav>

    <!-- HOME / HERO -->
    <section id="home" class="hero">
        <div class="container">
            <span class="section-subtitle">Institutional Grade Education</span>
            <h1>See What <span class="text-green">Smart Money</span> Hides</h1>
            <p>Master Orderflow, DOM Trading, and Price Action. Use our AI-powered tools to detect liquidity grabs, absorption, and hidden iceberg orders before the move happens.</p>
            <div class="flex justify-center gap-4">
                <button class="btn btn-primary" onclick="scrollToId('methods')">Start Learning</button>
                <button class="btn btn-outline" onclick="scrollToId('ai-analysis')">Live Demo</button>
            </div>
        </div>
    </section>

    <!-- TRADING METHODS (Orderflow + Price Action) -->
    <section id="methods">
        <div class="container">
            <div class="mb-4">
                <span class="section-subtitle">Methodology</span>
                <h2 class="section-title">Orderflow & Price Action</h2>
            </div>

            <div class="grid grid-cols-2 gap-8">
                <!-- Chart Visual -->
                <div class="panel">
                    <div class="panel-header">
                        <span>ES1! - Footprint Chart</span>
                        <span class="font-mono">Live</span>
                    </div>
                    <div class="chart-container">
                        <canvas id="orderflowChart"></canvas>
                        <div class="chart-overlay">
                            <div>BID: <span class="text-green font-mono" id="live-bid">4500.25</span></div>
                            <div>ASK: <span class="text-red font-mono" id="live-ask">4500.50</span></div>
                            <div>DELTA: <span class="font-mono" id="live-delta">-124</span></div>
                        </div>
                    </div>
                </div>

                <!-- Explanation Text -->
                <div class="flex flex-col justify-center gap-4">
                    <div class="glass-panel p-4" style="border-radius: 8px;">
                        <h3 class="font-bold mb-2 text-green">1. Imbalance Zones</h3>
                        <p class="text-secondary" style="color:var(--text-secondary); font-size:0.9rem;">
                            Look for large numbers inside the footprint (e.g., 5000 contracts on the Ask vs 200 on the Bid). This indicates aggressive selling interest often used to trap buyers.
                        </p>
                    </div>
                    <div class="glass-panel p-4" style="border-radius: 8px;">
                        <h3 class="font-bold mb-2 text-red">2. Absorption</h3>
                        <p class="text-secondary" style="color:var(--text-secondary); font-size:0.9rem;">
                            Price attempts to rise but gets stuck at a level while volume remains high. This signals "Smart Money" passively selling into the buying pressure (Iceberg Orders).
                        </p>
                    </div>
                    <div class="glass-panel p-4" style="border-radius: 8px;">
                        <h3 class="font-bold mb-2" style="color:var(--accent-yellow)">3. Liquidity Grabs</h3>
                        <p class="text-secondary" style="color:var(--text-secondary); font-size:0.9rem;">
                            A sharp spike to clear stops (e.g., above a previous high) followed by an immediate reversal. Our AI detects these footprints in real-time.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- DOM TRADING -->
    <section id="dom-education">
        <div class="container">
            <div class="mb-4">
                <span class="section-subtitle">Depth of Market</span>
                <h2 class="section-title">DOM Ladder Tactics</h2>
            </div>

            <div class="grid grid-cols-3 gap-8">
                <!-- Simulated DOM -->
                <div class="panel col-span-2">
                    <div class="panel-header">
                        <span>Level 2 Data (ES)</span>
                        <div class="flex gap-4">
                            <span class="text-red">Spoofing Detected: 0</span>
                            <span class="text-green">Hidden Orders: 1</span>
                        </div>
                    </div>
                    <div class="p-4">
                        <div id="dom-ladder" class="dom-ladder">
                            <!-- JS will populate this -->
                        </div>
                    </div>
                </div>

                <!-- DOM Concepts -->
                <div class="flex flex-col gap-4">
                    <div class="panel p-4 h-full">
                        <h3 class="font-bold mb-4">Live Market Interpretation</h3>
                        <ul style="list-style: disc; margin-left: 20px; color: var(--text-secondary); font-size: 0.9rem; display: flex; flex-direction: column; gap: 1rem;">
                            <li><strong class="text-primary">Stacked Orders:</strong> Large size at a single price acting as support/resistance.</li>
                            <li><strong class="text-primary">Pulling Liquidity:</strong> Large orders disappearing right before price hits them (fake walls).</li>
                            <li><strong class="text-primary">Spoofing:</strong> Placing a large order to scare traders, then cancelling it instantly.</li>
                        </ul>
                        <div class="mt-4 p-4" style="background: rgba(255,255,255,0.05); border-radius: 4px;">
                            <small class="text-secondary">SYSTEM LOG</small>
                            <div id="system-log" class="font-mono text-xs mt-2 text-green">Waiting for setup...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- AI ORDERFLOW ANALYSIS (MOST IMPORTANT) -->
    <section id="ai-analysis">
        <div class="container">
            <div class="flex justify-between items-end mb-4">
                <div>
                    <span class="section-subtitle">Powered by Neural Networks</span>
                    <h2 class="section-title">AI Orderflow Analysis</h2>
                </div>
                <button class="btn btn-primary" id="scan-btn" onclick="runAiAnalysis()">
                    <span class="icon">üîç</span> Scan Market
                </button>
            </div>

            <div class="ai-grid">
                <!-- AI Chart Output -->
                <div class="ai-chart-area" id="ai-chart-container">
                    <!-- Simulated Chart Background -->
                    <canvas id="aiChart" style="width:100%; height:100%;"></canvas>
                    
                    <!-- Overlay Zones (Hidden by default) -->
                    <div id="zone-buy" class="overlay-box" style="border-color: var(--accent-green); background: rgba(0,200,83,0.1);">BUY ZONE</div>
                    <div id="zone-sell" class="overlay-box" style="border-color: var(--accent-red); background: rgba(255,23,68,0.1);">SELL ZONE</div>
                    <div id="zone-wait" class="overlay-box" style="border-color: var(--accent-yellow); background: rgba(255,171,0,0.1);">NO TRADE</div>
                </div>

                <!-- AI Reasoning Panel -->
                <div class="ai-sidebar">
                    <!-- Status Card -->
                    <div class="panel p-4">
                        <h3 class="text-secondary text-xs font-bold uppercase">System Status</h3>
                        <div id="ai-status" class="font-mono font-bold text-primary mt-1">IDLE</div>
                        <div class="loader-bar" id="ai-loader">
                            <div class="loader-progress" id="ai-progress"></div>
                        </div>
                    </div>

                    <!-- Signal Card -->
                    <div class="ai-card" id="ai-signal-card">
                        <div class="flex justify-between items-center">
                            <span class="text-xs font-bold text-secondary">RECOMMENDATION</span>
                            <span id="ai-prob" class="tag" style="background:#333; color:#fff">0%</span>
                        </div>
                        <h2 id="ai-action" class="font-bold mt-2 text-lg">WAIT</h2>
                        <div class="stat-row text-secondary text-xs">
                            <span>RISK:REWARD</span>
                            <span id="ai-rr" class="text-primary">-</span>
                        </div>
                    </div>

                    <!-- Explanation -->
                    <div class="panel p-4 flex-grow">
                        <h3 class="text-xs font-bold text-secondary uppercase mb-2">Why?</h3>
                        <p id="ai-reasoning" class="text-sm" style="color: var(--text-secondary);">Click "Scan Market" to analyze the current orderflow, delta divergence, and DOM liquidity profile.</p>
                        
                        <div class="mt-4 border-t border-gray-700 pt-2">
                            <div class="stat-row text-xs">
                                <span>Delta:</span>
                                <span id="ai-metric-delta" class="font-mono">-</span>
                            </div>
                            <div class="stat-row text-xs">
                                <span>Volume Node:</span>
                                <span id="ai-metric-vol" class="font-mono">-</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- DASHBOARD / JOURNAL -->
    <section id="dashboard">
        <div class="container">
            <h2 class="section-title mb-4">AI Trade Journal</h2>
            <div class="panel">
                <table class="journal-table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Asset</th>
                            <th>Type</th>
                            <th>AI Confidence</th>
                            <th>Result</th>
                            <th>P&L</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Oct 24, 14:30</td>
                            <td>NQ1!</td>
                            <td class="text-green">LONG (Absorption)</td>
                            <td>88%</td>
                            <td><span class="tag tag-win">WIN</span></td>
                            <td class="text-green">+$450.00</td>
                        </tr>
                        <tr>
                            <td>Oct 24, 11:15</td>
                            <td>ES1!</td>
                            <td class="text-red">SHORT (Delta Div)</td>
                            <td>92%</td>
                            <td><span class="tag tag-win">WIN</span></td>
                            <td class="text-green">+$320.00</td>
                        </tr>
                        <tr>
                            <td>Oct 23, 16:00</td>
                            <td>CL1!</td>
                            <td class="text-yellow">NO TRADE</td>
                            <td>N/A</td>
                            <td><span class="tag">FLAT</span></td>
                            <td>$0.00</td>
                        </tr>
                        <tr>
                            <td>Oct 23, 10:45</td>
                            <td>ES1!</td>
                            <td class="text-red">SHORT (Spoof)</td>
                            <td>65%</td>
                            <td><span class="tag tag-loss">LOSS</span></td>
                            <td class="text-red">-$120.00</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </section>

    <!-- FOOTER -->
    <footer>
        <div class="container">
            <div class="nav-logo mb-4">FLOW<span>STATE</span></div>
            <p>Risk Warning: Trading futures and options involves substantial risk of loss and is not suitable for every investor.</p>
            <div class="mt-4">
                <a href="#" class="text-secondary" style="margin:0 10px">Privacy Policy</a>
                <a href="#" class="text-secondary" style="margin:0 10px">Terms of Service</a>
                <a href="#" class="text-secondary" style="margin:0 10px">Contact</a>
            </div>
            <p class="mt-4 text-xs opacity-50">¬© 2023 FlowState Trading. All rights reserved.</p>
        </div>
    </footer>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        // --- UTILITIES ---
        const $ = (id) => document.getElementById(id);
        const randomInt = (min, max) => Math.floor(Math.random() * (max - min + 1) + min);

        function scrollToId(id) {
            $(id).scrollIntoView({ behavior: 'smooth' });
        }

        // --- FOOTPRINT CHART ENGINE (CANVAS) ---
        const canvas = $('orderflowChart');
        const ctx = canvas.getContext('2d');
        let chartWidth, chartHeight;

        // Mock Data
        let candles = [];
        const candleCount = 40;
        const candleWidth = 20;
        const spacing = 5;
        
        function initChart() {
            chartWidth = canvas.parentElement.offsetWidth;
            chartHeight = canvas.parentElement.offsetHeight;
            canvas.width = chartWidth;
            canvas.height = chartHeight;

            // Generate initial data
            let price = 4500;
            for(let i=0; i<candleCount; i++) {
                let close = price + randomInt(-50, 50);
                let high = Math.max(price, close) + randomInt(0, 20);
                let low = Math.min(price, close) - randomInt(0, 20);
                let isUp = close > price;
                candles.push({
                    open: price,
                    high: high,
                    low: low,
                    close: close,
                    vol: randomInt(100, 500),
                    delta: isUp ? randomInt(50, 200) : randomInt(-200, -50),
                    footprint: generateFootprint(low, high)
                });
                price = close;
            }
            drawChart();
        }

        function generateFootprint(low, high) {
            // Simplified footprint data: bid/ask at specific levels
            let levels = [];
            let step = 2; // 2 tick steps
            for(let p = low; p <= high; p+=step) {
                levels.push({
                    price: p,
                    bid: randomInt(10, 100),
                    ask: randomInt(10, 100)
                });
            }
            return levels;
        }

        function drawChart() {
            ctx.fillStyle = "#000000";
            ctx.fillRect(0, 0, chartWidth, chartHeight);

            // Scale prices to canvas
            let minPrice = Math.min(...candles.map(c => c.low)) - 20;
            let maxPrice = Math.max(...candles.map(c => c.high)) + 20;
            let priceRange = maxPrice - minPrice;
            
            const getY = (price) => chartHeight - ((price - minPrice) / priceRange) * chartHeight;

            candles.forEach((c, i) => {
                let x = i * (candleWidth + spacing) + 20;
                let bodyTop = getY(Math.max(c.open, c.close));
                let bodyBottom = getY(Math.min(c.open, c.close));
                let highY = getY(c.high);
                let lowY = getY(c.low);
                
                let isUp = c.close >= c.open;
                let color = isUp ? "#00c853" : "#ff1744";

                // Wick
                ctx.strokeStyle = color;
                ctx.beginPath();
                ctx.moveTo(x + candleWidth/2, highY);
                ctx.lineTo(x + candleWidth/2, lowY);
                ctx.stroke();

                // Body
                ctx.fillStyle = isUp ? "rgba(0,200,83,0.2)" : "rgba(255,23,68,0.2)";
                ctx.fillRect(x, bodyTop, candleWidth, Math.max(1, bodyBottom - bodyTop));
                
                // Draw footprint numbers (simplified visual only)
                if (candleWidth > 15) {
                    ctx.fillStyle = color;
                    ctx.font = "8px sans-serif";
                    ctx.textAlign = "center";
                    
                    // Draw a few numbers inside
                    let midY = (bodyTop + bodyBottom) / 2;
                    if (midY) {
                        // ctx.fillText(c.delta, x + candleWidth/2, midY + 3); // Simple delta in body
                    }
                }
            });

            // Draw current price line
            let last = candles[candles.length-1];
            let y = getY(last.close);
            ctx.strokeStyle = "#ffffff";
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.moveTo(0, y);
            ctx.lineTo(chartWidth, y);
            ctx.stroke();
            ctx.setLineDash([]);
            
            // Price Label
            ctx.fillStyle = "#2962ff";
            ctx.fillRect(chartWidth - 50, y - 10, 50, 20);
            ctx.fillStyle = "white";
            ctx.fillText(last.close.toFixed(1), chartWidth - 25, y + 4);
        }

        // Live Update Simulation
        setInterval(() => {
            let last = candles[candles.length-1];
            let change = randomInt(-5, 5);
            last.close += change;
            if(last.close > last.high) last.high = last.close;
            if(last.close < last.low) last.low = last.close;
            
            // Update UI numbers
            $('live-bid').innerText = (last.close - 0.25).toFixed(2);
            $('live-ask').innerText = (last.close + 0.25).toFixed(2);
            $('live-delta').innerText = (last.delta + change * 10);
            $('live-delta').className = "font-mono " + (last.delta > 0 ? 'text-green' : 'text-red');

            // Occasionally add new candle
            if(randomInt(0, 100) > 95) {
                candles.shift();
                candles.push({
                    open: last.close,
                    high: last.close,
                    low: last.close,
                    close: last.close,
                    vol: 0,
                    delta: 0
                });
            }
            drawChart();
        }, 500); // Fast update

        // --- DOM LADDER LOGIC ---
        const domLadder = $('dom-ladder');
        let domPrice = 4500;
        
        function initDOM() {
            domLadder.innerHTML = '';
            // Center the view around price
            for(let i=14; i>=0; i--) {
                let price = domPrice + (i * 0.25);
                createRow(price, i === 7); // Highlight middle
            }
        }

        function createRow(price, isMid) {
            let bidVol = randomInt(10, 500);
            let askVol = randomInt(10, 500);
            
            let row = document.createElement('div');
            row.innerHTML = `
                <div class="dom-cell dom-ask" id="ask-${price}">${askVol}</div>
                <div class="dom-cell dom-price">${price.toFixed(2)}</div>
                <div class="dom-cell dom-bid" id="bid-${price}">${bidVol}</div>
            `;
            domLadder.appendChild(row);
        }

        function updateDOM() {
            // Randomly flash cells
            const cells = document.querySelectorAll('.dom-cell');
            let target = cells[randomInt(0, cells.length-1)];
            target.classList.add('dom-highlight');
            setTimeout(() => target.classList.remove('dom-highlight'), 200);

            // Randomly change volume
            if(randomInt(0,10) > 8) {
                let priceIdx = randomInt(0, 14);
                let price = domPrice + (priceIdx * 0.25); // Approximation logic
                let type = Math.random() > 0.5 ? 'ask' : 'bid';
                let el = document.getElementById(`${type}-${price.toFixed(2)}`);
                if(el) {
                    let newVal = parseInt(el.innerText) + randomInt(-50, 100);
                    if(newVal < 0) newVal = 0;
                    el.innerText = newVal;
                    
                    // Log spoofing
                    if(newVal > 800) {
                        $('system-log').innerText = `SPOOF ALERT: Large ${type.toUpperCase()} wall at ${price.toFixed(2)}`;
                        $('system-log').className = "font-mono text-xs mt-2 text-red blink";
                    }
                }
            }
        }
        setInterval(updateDOM, 100);


        // --- AI ANALYSIS SYSTEM ---
        const scenarios = [
            {
                type: 'buy',
                action: 'LONG',
                reason: 'Aggressive absorption detected on the bid. Delta divergence shows buyers overpowering sellers at key support.',
                prob: '84%',
                rr: '1:3.5',
                delta: '+420 (Bullish)',
                vol: 'POC @ 4498.50'
            },
            {
                type: 'sell',
                action: 'SHORT',
                reason: 'Failed breakout above resistance with low volume. Immediate delta flip suggests a stop-hunt/liquidity grab.',
                prob: '91%',
                rr: '1:4.2',
                delta: '-510 (Bearish)',
                vol: 'HVN @ 4505.00'
            },
            {
                type: 'wait',
                action: 'NO TRADE',
                reason: 'Market is in balance. Low volatility and neutral delta. Waiting for breakout or confirmed imbalance.',
                prob: 'N/A',
                rr: '-',
                delta: 'Neutral',
                vol: 'Balanced'
            }
        ];

        function runAiAnalysis() {
            const btn = $('scan-btn');
            const status = $('ai-status');
            const loader = $('ai-loader');
            const progress = $('ai-progress');
            const card = $('ai-signal-card');
            
            // Reset UI
            $('zone-buy').style.opacity = 0;
            $('zone-sell').style.opacity = 0;
            $('zone-wait').style.opacity = 0;
            card.className = 'ai-card'; // Reset colors
            
            btn.disabled = true;
            btn.innerText = "Scanning...";
            loader.style.display = 'block';
            status.innerText = "CONNECTING TO DATA FEED...";
            status.className = "font-mono font-bold text-yellow mt-1";

            let width = 0;
            const interval = setInterval(() => {
                width += 5;
                progress.style.width = width + '%';
                
                if(width === 30) status.innerText = "ANALYZING DELTA...";
                if(width === 60) status.innerText = "DETECTING LIQUIDITY...";
                if(width === 90) status.innerText = "CALCULATING PROBABILITY...";

                if(width >= 100) {
                    clearInterval(interval);
                    showResult();
                    btn.disabled = false;
                    btn.innerText = "Scan Market";
                    loader.style.display = 'none';
                    progress.style.width = '0%';
                }
            }, 100);
        }

        function showResult() {
            const result = scenarios[randomInt(0, scenarios.length - 1)];
            const status = $('ai-status');
            
            status.innerText = "ANALYSIS COMPLETE";
            status.className = "font-mono font-bold text-green mt-1";

            // Update Text
            $('ai-action').innerText = result.action;
            $('ai-prob').innerText = result.prob;
            $('ai-rr').innerText = result.rr;
            $('ai-reasoning').innerText = result.reason;
            $('ai-metric-delta').innerText = result.delta;
            $('ai-metric-vol').innerText = result.vol;

            // Style Card
            const card = $('ai-signal-card');
            card.classList.remove('buy', 'sell', 'wait');
            card.classList.add(result.type);
            $('ai-prob').style.background = result.type === 'sell' ? '#ff1744' : (result.type === 'buy' ? '#00c853' : '#333');

            // Show Zone Overlay
            const chartCont = $('ai-chart-container');
            let zone = $('zone-' + result.type);
            zone.style.opacity = 1;
            
            // Random position for visual effect
            let top = randomInt(20, 60);
            let left = randomInt(10, 60);
            let w = randomInt(20, 30);
            let h = randomInt(20, 40);
            
            zone.style.top = top + '%';
            zone.style.left = left + '%';
            zone.style.width = w + '%';
            zone.style.height = h + '%';
        }

        // --- INITIALIZATION ---
        window.addEventListener('resize', initChart);
        window.addEventListener('load', () => {
            initChart();
            initDOM();
            // Init AI Chart (static background)
            let aiCanvas = $('aiChart');
            aiCanvas.width = aiCanvas.parentElement.offsetWidth;
            aiCanvas.height = aiCanvas.parentElement.offsetHeight;
            let aCtx = aiCanvas.getContext('2d');
            aCtx.fillStyle = "#131722"; // Dark bg
            aCtx.fillRect(0,0,aiCanvas.width, aiCanvas.height);
            
            // Draw grid lines
            aCtx.strokeStyle = "#2a2e39";
            aCtx.beginPath();
            for(let i=0; i<aiCanvas.width; i+=50) { aCtx.moveTo(i,0); aCtx.lineTo(i, aiCanvas.height); }
            for(let i=0; i<aiCanvas.height; i+=50) { aCtx.moveTo(0,i); aCtx.lineTo(aiCanvas.width, i); }
            aCtx.stroke();
        });

    </script>
</body>
</html>
